!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=17)}([function(e,t,i){"use strict";i.d(t,"c",(function(){return s})),i.d(t,"k",(function(){return n})),i.d(t,"l",(function(){return r})),i.d(t,"i",(function(){return a})),i.d(t,"g",(function(){return c})),i.d(t,"d",(function(){return o})),i.d(t,"h",(function(){return d})),i.d(t,"m",(function(){return h})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return _})),i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return m})),i.d(t,"j",(function(){return g}));const s={container:document.querySelector(".header-nav-container"),lightNotAuthTemplate:document.querySelector("#header-nav-not-logged-in"),lightAuthTemplate:document.querySelector("#header-nav-logged-in"),darkNotAuthTemplate:document.querySelector("#header-nav-not-logged-in-dark"),darkAuthTemplate:document.querySelector("#header-nav-logged-in-dark"),authButtonSelector:".header__nav-item-button"},n={form:{formSelector:".header-search__form",requiredInputSelectors:[".header-search__input"],actionButtonSelector:".header-search__button"}},r={container:document.querySelector(".search-results"),selectors:{items:".search-results__items"},templates:{results:document.querySelector("#search-results"),searchResultsProcess:document.querySelector("#search-results-process"),searchNoResults:document.querySelector("#search-no-results"),searchError:document.querySelector("#search-error")}},a={container:document.querySelector(".saved-articles"),templates:{results:document.querySelector("#saved-articles")},selectors:{items:".saved-articles__items"}},c={container:document.querySelector(".popup"),contentContainer:document.querySelector(".popup__content"),closeIcon:document.querySelector(".popup__close")},o={template:document.querySelector("#popup-login"),form:{formSelector:".popup__form",actionButtonSelector:".popup__form-button",requiredInputSelectors:[".popup__form-input_email",".popup__form-input_password"]}},d={template:document.querySelector("#popup-registration"),form:{formSelector:".popup__form",actionButtonSelector:".popup__form-button",requiredInputSelectors:[".popup__form-input_email",".popup__form-input_password",".popup__form-input_name"]}},h={template:document.querySelector("#popup-successful-registration")},l="https://api.news-stash.tk",u={signup:l+"/signup",signin:l+"/signin",logout:l+"/logout",getSpecificUser:l+"/users/me",getArticles:l+"/articles",createArticle:l+"/articles",deleteArticle:l+"/articles"},_={url:"https://newsapi.org/v2/everything",sortBy:"publishedAt",pageSize:100,apiKey:"5c1f5cc59318410fb892e15b34bc2d4d"},p={articlesQuantity:3},m={template:document.querySelector("#article-card"),actionTemplates:{baseAction:document.querySelector("#article-card-base-action"),likeAction:document.querySelector("#article-card-like-action"),unlikeAction:document.querySelector("#article-card-unlike-action"),savedAction:document.querySelector("#article-card-saved-action")}},g={name:document.querySelector(".header-saved__name"),articlesCount:document.querySelector(".header-saved__articles-count"),details:document.querySelector(".header-saved__details"),tagTemplate:document.querySelector("#header-saved-detail-tag")}},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(){this.dependencies={},this._handlers=[]}_setHandlers(e){e.forEach(({element:e,event:t,method:i})=>{this._addEventListener(e,t,i)})}_addEventListener(e,t,i){e.addEventListener(t,i),this._handlers.push({element:e,event:t,method:i})}_reset(){this._handlers.forEach(e=>{e.element.removeEventListener(e.event,e.method)})}setDependencies(e){this._dependencies=e}}},function(e,t,i){"use strict";i(8);var s=i(1);class n extends s.a{constructor(e){super();const{template:t,actionTemplates:i,article:s,dependencies:n}=e;this._article=s,this._actionTemplates=i,this.like=this.like.bind(this),this.unlike=this.unlike.bind(this),this.remove=this.remove.bind(this),this.setDependencies(n),this._createCard(t)}_getCardDate(e){const t=new Date(e),i=t.getFullYear(),s=t.getMonth();return`${t.getDate()} ${["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"][s]}, ${i}`}_getCardType(){let e="base";return this._dependencies.auth&&this._dependencies.articlesList&&(this._dependencies.auth.isSavedPage()?e="saved":this._dependencies.auth.isAuth()&&(e=this._dependencies.articlesList.articleIsLiked(this._newsUrl)?"unlike":"like")),e}_setCardAction(e,t){this._reset(),this._iconContainer.innerHTML="",this._iconContainer.appendChild(e.cloneNode(!0).content),t&&this._setHandlers([{element:this._iconContainer.querySelector(".article-card__action"),event:"click",method:t}])}_setCardActionBlock(){switch(this._getCardType()){case"saved":this._setCardAction(this._actionTemplates.savedAction,this.remove);break;case"unlike":this._setCardAction(this._actionTemplates.unlikeAction,this.unlike);break;case"like":this._setCardAction(this._actionTemplates.likeAction,this.like);break;default:this._setCardAction(this._actionTemplates.baseAction,null)}}_createCard(e){const{_id:t,source:i,title:s,date:n,text:r,link:a,image:c,keyword:o}=this._article;this._id=t,this._newsUrl=a,this._keyword=o,this._container=e.cloneNode(!0).content;const d=this._container.querySelector(".article-card__img");d.src=c,d.alt=s,this._container.querySelector(".article-card__date").textContent=this._getCardDate(n),this._container.querySelector(".article-card__title").textContent=s,this._container.querySelector(".article-card__text").textContent=r,this._container.querySelector(".article-card__source").textContent=i,this._iconContainer=this._container.querySelector(".article-card__icon-container"),this._setCardActionBlock(),this._container.querySelector(".article-card__link").href=a;const h=this._iconContainer.querySelector(".article-card__tag");h&&(h.textContent=this._keyword),this._dependencies.articlesList&&this._dependencies.articlesList.articleIsLiked(this._newsUrl)&&(this._id=this._dependencies.articlesList.getLikedByLink(this._newsUrl)._id)}like(){if(this._dependencies.mainApi&&this._dependencies.articlesList){const{source:e,title:t,date:i,text:s,link:n,image:r,keyword:a}=this._article;this._dependencies.mainApi.createArticle({source:e,title:t,date:i,text:s,link:n,image:r,keyword:a}).then(e=>{this._dependencies.articlesList.addLiked(e),this._id=e._id,this._setCardActionBlock()}).catch(e=>console.log(e))}}unlike(){this._dependencies.mainApi&&this._dependencies.articlesList&&this._dependencies.mainApi.removeArticle(this._id).then(()=>{this._dependencies.articlesList.removeLiked(this._id),this._setCardActionBlock()}).catch(e=>console.log(e))}remove(){this._dependencies.mainApi&&this._dependencies.articlesList&&this._dependencies.mainApi.removeArticle(this._id).then(()=>{this._dependencies.articlesList.removeLiked(this._id),this._dependencies.articlesList.updateArticles(this._dependencies.articlesList.getLiked()),this._reset(),this._dependencies.savedStat&&this._dependencies.savedStat.render()}).catch(e=>console.log(e))}updateView(){this._setCardActionBlock()}getDomElement(){return this._container}}i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return c})),i.d(t,"a",(function(){return r}));const r=e=>new n(e),a=()=>{const e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`},c=()=>{const e=(new Date).getTime(),t=new Date(e-6048e5);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}},function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i(9);var s=i(1);class n extends s.a{constructor(e){super();const{lightNotAuthTemplate:t,lightAuthTemplate:i,darkNotAuthTemplate:s,darkAuthTemplate:n,authButtonSelector:r,theme:a,container:c}=e;this._notAuthTemplate="light"===a?t:s,this._authTemplate="light"===a?i:n,this._authButtonSelector=r,this._container=c}render({isLoggedIn:e,userName:t}){this._reset(),this._container.innerHTML="";const i=e?this._authTemplate:this._notAuthTemplate;let s;this._container.appendChild(i.cloneNode(!0).content),!e&&this._dependencies.loginPopup?s=this._dependencies.loginPopup.open:e&&this._dependencies.auth&&(s=this._dependencies.auth.logout,document.querySelector(".header__nav-item-name").textContent=t),s&&this._setHandlers([{element:this._container.querySelector(this._authButtonSelector),event:"click",method:s}])}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(e){const{articlesQuantity:t}=e;this._lastPhrase="",this._currentArticleIndex=0,this._articles=[],this._liked=[],this._articlesQuantity=t}hasArticles(){return this._articles.length>0}articleIsLiked(e){return this._liked.some(t=>t.link===e)}getLikedByLink(e){return this._liked.find(t=>t.link===e)}getPhrase(){return this._lastPhrase}getLikedCount(){return this._liked.length}someMore(){return this._articles.length>this._currentArticleIndex}setLiked(e){this._liked=e||[]}getLiked(){return this._liked}addLiked(e){this._liked.push(e)}removeLiked(e){this._liked=this._liked.filter(t=>t._id!==e)}getKeywordsQuantity(){const e=this._liked.reduce((e,{keyword:t})=>(e[t]?e[t]+=1:e[t]=1,e),{});return Object.entries(e).sort((e,t)=>t[1]-e[1])}updateArticles(e,t=""){this._articles=e,this._lastPhrase=t,this._currentArticleIndex=0}getArticlesQuantity(e=!1){if(e)return this._articles;const t=this._currentArticleIndex,i=Math.min(this._currentArticleIndex+this._articlesQuantity,this._articles.length);return t>=i?[]:(this._currentArticleIndex=i,this._articles.slice(t,i))}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(){this.logout=this.logout.bind(this)}_setUserData({name:e}){this._name=e,this._loggedIn=!0}_clearUserData(){this._name="",this._loggedIn=!1}_redirectToMainPage(){this.isSavedPage()&&(window.location.href="/main")}setDependencies(e){this._dependencies=e}isAuth(){return this._loggedIn}isSavedPage(){return"/"===window.location.pathname||"/savedArticles/"===window.location.pathname}getUserName(){return this._name}authenticate(){this._dependencies.mainApi&&this._dependencies.mainApi.getUserData().then(e=>{if(e.message)throw new Error("Unauthorized");this._setUserData(e)}).then(()=>this._dependencies.mainApi.getArticles()).then(e=>this._dependencies.articlesList.setLiked(e)).catch(()=>{this._clearUserData(),this._redirectToMainPage()}).finally(()=>{this._dependencies.header&&this._dependencies.header.render({isLoggedIn:this._loggedIn,userName:this._name}),this._dependencies.newsCardList&&this._dependencies.newsCardList.updateCardsViews(),this.isSavedPage()&&(this._dependencies.articlesList&&this._dependencies.articlesList.updateArticles(this._dependencies.articlesList.getLiked()),this._dependencies.savedStat&&this._dependencies.savedStat.render())})}logout(){this._clearUserData(),this._dependencies.mainApi&&this._dependencies.mainApi.logout().finally(()=>{this._dependencies.header&&this._dependencies.header.render({userName:this._name,isLoggedIn:this._loggedIn})}),this._dependencies.newsCardList&&this._dependencies.newsCardList.updateCardsViews(),this._redirectToMainPage()}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));class s{constructor(e){this._routes=e}signup({email:e,password:t,name:i}){return fetch(this._routes.signup,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:i})}).catch(e=>new Error(e.message))}signin({email:e,password:t}){return fetch(this._routes.signin,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).catch(e=>new Error(e.message))}logout(){return fetch(this._routes.logout,{method:"POST",credentials:"include"}).catch(e=>new Error(e.message))}getUserData(){return fetch(this._routes.getSpecificUser,{method:"GET",credentials:"include"}).then(e=>e.json()).catch(e=>e)}getArticles(){return fetch(this._routes.getArticles,{method:"GET",credentials:"include"}).then(e=>e.json()).catch(e=>console.log(e))}createArticle(e){const{keyword:t,title:i,text:s,source:n,image:r,link:a,date:c}=e;return fetch(this._routes.createArticle,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:t,title:i,text:s,source:n,image:r,link:a,date:c})}).then(e=>e.json()).catch(e=>console.log(e))}removeArticle(e){return fetch(`${this._routes.deleteArticle}/${e}`,{method:"DELETE",credentials:"include"}).then(e=>e.json()).catch(e=>console.log(e))}}},function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i(10);var s=i(1),n=i(2);class r extends s.a{constructor(e){super();const{container:t,results:i,searchResultsProcess:s,searchNoResults:n,searchError:r,selectors:a}=e;this._container=t,this._results=i,this._searchResultsProcess=s,this._searchNoResults=n,this._searchError=r,this._selectors=a,this._cards=[],this._showMore=this._showMore.bind(this)}_renderTemplate(e){this._reset(),this._container.innerHTML="",this._container.appendChild(e.cloneNode(!0).content)}_showNewsCardList(){this._container.classList.remove("search-results_hidden")}hideNewsCardList(){this._container.classList.add("search-results_hidden")}renderLoader(){this._showNewsCardList(),this._renderTemplate(this._searchResultsProcess)}renderError(){this._renderTemplate(this._searchError)}renderResults(){this._showNewsCardList(),this._renderTemplate(this._results),this._resultsContainer=this._container.querySelector(this._selectors.items),this._showMoreButton=this._container.querySelector(".search-results__show-more"),this._setHandlers([{element:this._showMoreButton,event:"click",method:this._showMore}]),this._showMore()}_showMore(){if(this._dependencies.articlesList){let e=!1;this._dependencies.auth&&(e=this._dependencies.auth.isSavedPage());this._dependencies.articlesList.getArticlesQuantity(e).forEach(e=>{this._addCard({...e,keyword:e.keyword||this._dependencies.articlesList.getPhrase()})}),this._dependencies.articlesList.someMore()||this._showMoreButton.classList.add("search-results__show-more_hidden")}}_addCard(e){if(this._dependencies.createArticleCard&&this._dependencies.cardOptions){const t={auth:this._dependencies.auth,mainApi:this._dependencies.mainApi,articlesList:this._dependencies.articlesList,savedStat:this._dependencies.savedStat},i=Object(n.a)({...this._dependencies.cardOptions,article:e,dependencies:t});this._resultsContainer.appendChild(i.getDomElement()),this._cards.push(i)}}renderNoResults(){this._renderTemplate(this._searchNoResults)}updateCardsViews(){this._cards.forEach(e=>e.updateView())}}},function(e,t,i){},function(e,t,i){},function(e,t,i){},,,,,function(e,t,i){},,function(e,t,i){"use strict";i.r(t);i(15);var s=i(0),n=i(5),r=i(6),a=i(3),c=i(4),o=i(7),d=i(1);class h extends d.a{constructor(e){super();const{name:t,articlesCount:i,details:s,tagTemplate:n}=e;this._name=t,this._articlesCount=i,this._details=s,this._tagTemplate=n}_renderArticlesCount(){this._dependencies.articlesList&&(this._articlesCount.textContent=this._dependencies.articlesList.getLikedCount())}_renderSeparator(e){const t=document.createElement("span");t.textContent=e,this._details.appendChild(t)}_renderTag(e){const t=this._tagTemplate.cloneNode(!0).content.querySelector(".header-saved__detail-tag");t.textContent=e,this._details.appendChild(t)}_renderKeywords(){if(this._dependencies.articlesList){const e=this._dependencies.articlesList.getKeywordsQuantity().map(([e])=>e);e.length>0&&this._renderSeparator("По ключевым словам: ");const[t,i,s]=e;1===e.length?this._renderTag(t):2===e.length?(this._renderTag(t),this._renderSeparator(" и "),this._renderTag(i)):3===e.length?(this._renderTag(t),this._renderSeparator(", "),this._renderTag(i),this._renderSeparator(" и "),this._renderTag(s)):e.length>3&&(this._renderTag(t),this._renderSeparator(", "),this._renderTag(i),this._renderSeparator(" и "),this._renderTag(e.length-2+" другим"))}}_clearContent(){this._articlesCount.textContent=0,this._details.innerHTML=""}render(){this._clearContent(),this._renderArticlesCount(),this._renderKeywords(),this._dependencies.auth&&(this._name.textContent=this._dependencies.auth.getUserName()),this._dependencies.newsCardList&&this._dependencies.newsCardList.renderResults()}}var l=i(2);const u=new r.a(s.e),_=new n.a,p=new a.a({...s.c,theme:"dark"}),m=new h({...s.j}),g=new c.a({...s.a}),f=new o.a({container:s.i.container,...s.i.templates,selectors:s.i.selectors});p.setDependencies({auth:_}),m.setDependencies({articlesList:g,newsCardList:f,auth:_}),f.setDependencies({mainApi:u,articlesList:g,createArticleCard:l.a,cardOptions:s.b,auth:_,savedStat:m}),_.setDependencies({mainApi:u,header:p,newsCardList:f,articlesList:g,savedStat:m}),_.authenticate()}]);